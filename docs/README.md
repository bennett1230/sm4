"# SM4的·软件实现和优化说明" 

S盒实现
S盒是一个256字节的静态查找表，用于实现非线性变换。每个字节输入通过查表映射为另一个字节输出。S盒数据来源于SM4标准定义，直接硬编码在类变量中。

循环左移操作
循环左移函数_rotl接收一个32位字x和移位位数n，通过位操作实现循环移位。具体实现是将x左移n位与右移(32-n)位的结果进行或运算，最后用掩码确保结果为32位。

非线性变换τ
非线性变换τ函数接收一个32位字a，将其拆分为4个字节，每个字节通过S盒替换后重新组合成32位字。实现时使用移位和掩码提取字节，查表替换后重新组合。

线性变换L
线性变换L函数接收32位字b，通过异或b和b的循环左移结果(2、10、18、24位)实现。直接调用_rotl函数完成循环移位操作。

线性变换L'
线性变换L'函数用于密钥扩展，接收32位字b，通过异或b和b的循环左移结果(13、23位)实现。与L变换类似但使用不同的移位参数。

合成变换T
合成变换T函数是L变换和τ变换的组合，先对输入x应用τ变换，再对结果应用L变换。这是加密轮函数的核心组件。

合成变换T'
合成变换T'函数是L'变换和τ变换的组合，先对输入x应用τ变换，再对结果应用L'变换。这是密钥扩展的核心组件。

轮函数F
轮函数F接收4个32位字和轮密钥rk，计算x1⊕x2⊕x3⊕rk后应用T变换，最后与x0异或。这是加密/解密每轮的核心操作。

密钥扩展算法
密钥扩展算法将16字节初始密钥分为4个字，与系统参数FK异或得到初始K数组。然后通过32轮迭代生成轮密钥，每轮使用T'变换和固定参数CK。

加密/解密函数
加密和解密函数处理16字节输入数据，分为4个字后进行32轮迭代。加密使用正向轮密钥，解密使用逆向轮密钥。最后对结果进行反序输出。
